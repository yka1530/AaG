<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Highfy ðŸŽµ</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#121212;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}
header {
  padding:15px;
  background:#000;
  font-size:22px;
  font-weight:bold;
  color:#1db954;
  text-align:center;
}
.container {
  display:flex;
  flex:1;
  overflow:hidden;
  flex-wrap:wrap;
}
.playlist {
  width:250px;
  min-width:200px;
  background:#181818;
  overflow-y:auto;
  border-right:1px solid #333;
}
.playlist-item {
  padding:12px;
  cursor:pointer;
  border-bottom:1px solid #222;
}
.playlist-item:hover { background:#282828; }
.playlist-item.active { background:#1db954; color:#000; }
.player {
  flex:1;
  min-width:300px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:20px;
  text-align:center;
}
.cover {
  width:300px;
  height:300px;
  border-radius:12px;
  object-fit:cover;
  margin-bottom:20px;
  background:#333;
}
.title { font-size:20px; margin:10px 0; }
.controls { display:flex; align-items:center; margin-top:10px; flex-wrap:wrap; justify-content:center; }
.controls button {
  margin:4px;
  padding:10px 16px;
  border:0;
  border-radius:50%;
  background:#1db954;
  color:#fff;
  font-size:18px;
  cursor:pointer;
}
.controls button:hover { background:#1ed760; }
.speed button, #shuffle, #repeat {
  margin:4px;
  padding:6px 12px;
  border:0;
  border-radius:6px;
  background:#333;
  color:#fff;
  cursor:pointer;
}
.speed button.active, #shuffle.active, #repeat.active { background:#1db954; color:#000; }
#progress { width:80%; margin:10px 0; }
.time { display:flex; justify-content:space-between; width:80%; font-size:14px; margin-bottom:5px; }
@media(max-width:700px){
  .container { flex-direction:column; }
  .playlist { width:100%; max-height:150px; order:2; border-right:none; border-top:1px solid #333; }
  .player { order:1; }
  .cover { width:200px; height:200px; }
}
</style>
</head>
<body>
<header>Highfy ðŸŽ¶</header>
<div class="container">
<div class="playlist" id="playlist"></div>
<div class="player">
<img id="cover" class="cover" src="" alt="cover">
<div class="title" id="title">â€”</div>
<div class="time">
  <span id="currentTime">0:00</span>
  <span id="duration">0:00</span>
</div>
<input type="range" id="progress" min="0" max="100" value="0">
<audio id="audio" preload="metadata"></audio>
<div class="controls">
  <button id="prev">Prev</button>
  <button id="back">-10s</button>
  <button id="play">Play</button>
  <button id="forward">+10s</button>
  <button id="next">Next</button>
</div>
<div class="speed">
  <button data-speed="0.25">0.25x</button>
  <button data-speed="0.5">0.5x</button>
  <button data-speed="0.75">0.75x</button>
  <button data-speed="1" class="active">1x</button>
  <button data-speed="1.25">1.25x</button>
  <button data-speed="1.5">1.5x</button>
  <button data-speed="1.75">1.75x</button>
  <button data-speed="2">2x</button>
  <button id="shuffle">Shuffle</button>
  <button id="repeat">Repeat</button>
</div>
</div>
</div>

<script>
const repoUser="yka1530"; 
const repoName="AaG";
const folder="tracks";
const covers="covers";

const audio=document.getElementById('audio');
const titleEl=document.getElementById('title');
const coverEl=document.getElementById('cover');
const playlistEl=document.getElementById('playlist');
const progress=document.getElementById('progress');
const currentTimeEl=document.getElementById('currentTime');
const durationEl=document.getElementById('duration');
const playBtn=document.getElementById('play');
const nextBtn=document.getElementById('next');
const prevBtn=document.getElementById('prev');
const backBtn=document.getElementById('back');
const forwardBtn=document.getElementById('forward');
const speedBtns=document.querySelectorAll('.speed button[data-speed]');
const shuffleBtn=document.getElementById('shuffle');
const repeatBtn=document.getElementById('repeat');

let tracks=[];
let current=0;
let shuffle=false;
let repeat=false;

let savedTrack=parseInt(localStorage.getItem('lastTrack'))||0;
let savedTime=parseFloat(localStorage.getItem('lastTime'))||0;

async function fetchTracks(){
  const url=`https://api.github.com/repos/${repoUser}/${repoName}/contents/${folder}`;
  const res=await fetch(url);
  const data=await res.json();
  tracks=data.filter(f=>f.name.endsWith(".mp3")||f.name.endsWith(".mp4")).map(f=>({
    name:f.name,
    url:f.download_url,
    cover:`https://raw.githubusercontent.com/${repoUser}/${repoName}/main/${covers}/${f.name.replace(/\.(mp3|mp4)$/,'')}.jpg`
  }));
  renderPlaylist();
  loadTrack(savedTrack);
}

function renderPlaylist(){
  playlistEl.innerHTML="";
  tracks.forEach((track,i)=>{
    const item=document.createElement("div");
    item.className="playlist-item";
    item.textContent=track.name;
    item.onclick=()=>loadTrack(i);
    playlistEl.appendChild(item);
  });
}

function formatTime(sec){
  const m=Math.floor(sec/60);
  const s=Math.floor(sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

function loadTrack(i){
  current=i;
  const track=tracks[i];
  audio.src=track.url;
  titleEl.textContent=track.name;
  coverEl.src=track.cover;
  audio.currentTime=(i===savedTrack)?savedTime:0;
  audio.play();
  playBtn.textContent="Pause";
  updateActive();
  saveProgress();
}

function updateActive(){
  document.querySelectorAll(".playlist-item").forEach((el,i)=>{
    el.classList.toggle("active",i===current);
  });
}

playBtn.onclick=()=>{if(audio.paused){audio.play();playBtn.textContent="Pause";}else{audio.pause();playBtn.textContent="Play";}};
nextBtn.onclick=()=>nextTrack();
prevBtn.onclick=()=>prevTrack();
backBtn.onclick=()=>{audio.currentTime=Math.max(0,audio.currentTime-10);};
forwardBtn.onclick=()=>{audio.currentTime=Math.min(audio.duration,audio.currentTime+10);};

speedBtns.forEach(btn=>{btn.onclick=()=>{speedBtns.forEach(b=>b.classList.remove("active"));btn.classList.add("active");audio.playbackRate=parseFloat(btn.dataset.speed);};});

shuffleBtn.onclick=()=>{shuffle=!shuffle;shuffleBtn.classList.toggle('active');};
repeatBtn.onclick=()=>{repeat=!repeat;repeatBtn.classList.toggle('active');};

audio.ontimeupdate=()=>{
  if(audio.duration){
    progress.value=(audio.currentTime/audio.duration)*100;
    currentTimeEl.textContent=formatTime(audio.currentTime);
    durationEl.textContent=formatTime(audio.duration);
    saveProgress();
  }
};
progress.oninput=()=>{audio.currentTime=(progress.value/100)*audio.duration;};

function saveProgress(){localStorage.setItem('lastTrack',current);localStorage.setItem('lastTime',audio.currentTime);}

function nextTrack(){if(shuffle){loadTrack(Math.floor(Math.random()*tracks.length));}else{loadTrack((current+1)%tracks.length);}}
function prevTrack(){if(shuffle){loadTrack(Math.floor(Math.random()*tracks.length));}else{loadTrack((current-1+tracks.length)%tracks.length);}}
audio.onended=()=>{if(repeat)loadTrack(current);else nextTrack();};

fetchTracks();
</script>
</body>
</html>
