<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Woṭer | وتر</title>
<style>
body {
  margin:0;
  font-family: 'Arial', sans-serif;
  color:#bfbfbf;
  display:flex;
  flex-direction:column;
  height:100vh;
  background: #5d4037; /* بني داكن للخلفية */
}

header {
  padding:15px;
  background: #1c0b00;
  font-size:26px;
  font-weight:bold;
  color:#bfbfbf;
  text-align:center;
}
header span {
  font-family: 'Segoe UI', sans-serif;
  font-size:28px;
  color:#bfbfbf;
}

.container {
  display:flex;
  flex:1;
  overflow:hidden;
  flex-wrap:wrap;
}
.playlist {
  width:250px;
  min-width:200px;
  background: #3e2723;
  overflow-y:auto;
  border-right:2px solid #1c0b00;
}
.playlist-item {
  padding:12px;
  cursor:pointer;
  border-bottom:1px solid #2a150a;
  transition: all 0.2s;
  color:#bfbfbf;
}
.playlist-item:hover { background: #5d4037; transform: scale(1.02);}
.playlist-item.active { background:#bfbfbf; color:#1c0b00; font-weight:bold; }

.player {
  flex:1;
  min-width:300px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:20px;
  text-align:center;
  border-radius:12px;
  background: #3e2723;
}
.cover {
  width:300px;
  height:300px;
  border-radius:12px;
  object-fit:cover;
  margin-bottom:20px;
  background:#1c0b00;
}
.title { font-size:20px; margin:10px 0; color:#bfbfbf; text-shadow: 1px 1px 2px #000;}
.controls { display:flex; align-items:center; margin-top:10px; flex-wrap:wrap; justify-content:center; }
.controls button {
  margin:4px;
  padding:10px 16px;
  border:0;
  border-radius:12px;
  background:#1c0b00;
  color:#bfbfbf;
  font-size:18px;
  cursor:pointer;
  box-shadow: 0 4px 6px #00000050;
  transition: all 0.2s;
}
.controls button:hover { background:#3e2723; transform: translateY(-2px);}
.controls button:active { transform: translateY(1px); box-shadow: 0 2px 4px #00000050; }
.speedDial {
  position:relative;
  margin-top:15px;
}
.speedDial select {
  padding:6px 12px;
  border-radius:6px;
  border:none;
  background:#1c0b00;
  color:#bfbfbf;
  cursor:pointer;
  box-shadow: inset 0 0 5px #00000060;
}
#progress { width:80%; margin:10px 0; }
.time { display:flex; justify-content:space-between; width:80%; font-size:14px; margin-bottom:5px; color:#bfbfbf; }
footer {
  padding:8px;
  background:#1c0b00;
  text-align:center;
  font-size:12px;
  color:#bfbfbf;
}
@media(max-width:700px){
  .container { flex-direction:column; }
  .playlist { width:100%; max-height:150px; order:2; border-right:none; border-top:2px solid #1c0b00; }
  .player { order:1; }
  .cover { width:200px; height:200px; }
}
</style>
</head>
<body>
<header><span>Woṭer</span> | وتر</header>
<div class="container">
<div class="playlist" id="playlist"></div>
<div class="player">
<img id="cover" class="cover" src="" alt="cover">
<div class="title" id="title">—</div>
<div class="time">
  <span id="currentTime">0:00</span>
  <span id="duration">0:00</span>
</div>
<input type="range" id="progress" min="0" max="100" value="0">
<audio id="audio" preload="metadata"></audio>
<div class="controls">
  <button id="prev">◄◄</button>
  <button id="back">⟲</button>
  <button id="play">▶</button>
  <button id="forward">⟳</button>
  <button id="next">►►</button>
</div>
<div class="speedDial">
  <select id="speedSelect">
    <option value="0.25">0.25x</option>
    <option value="0.5">0.5x</option>
    <option value="0.75">0.75x</option>
    <option value="1">1x</option>
    <option value="1.25">1.25x</option>
    <option value="1.5">1.5x</option>
    <option value="1.75">1.75x</option>
    <option value="2">2x</option>
  </select>
</div>
</div>
</div>
<footer>حقوق الموقع © 2025 Woṭer | وتر</footer>

<script>
const repoUser="yka1530"; 
const repoName="AaG";
const folder="tracks";

const audio=document.getElementById('audio');
const titleEl=document.getElementById('title');
const coverEl=document.getElementById('cover');
const playlistEl=document.getElementById('playlist');
const progress=document.getElementById('progress');
const currentTimeEl=document.getElementById('currentTime');
const durationEl=document.getElementById('duration');
const playBtn=document.getElementById('play');
const nextBtn=document.getElementById('next');
const prevBtn=document.getElementById('prev');
const backBtn=document.getElementById('back');
const forwardBtn=document.getElementById('forward');
const speedSelect=document.getElementById('speedSelect');

let tracks=[];
let current=0;
let savedTrack=parseInt(localStorage.getItem('lastTrack'));
let savedTime=parseFloat(localStorage.getItem('lastTime'))||0;
let savedRate=parseFloat(localStorage.getItem('playbackRate'))||1;

async function fetchTracks(){
  const url=`https://api.github.com/repos/${repoUser}/${repoName}/contents/${folder}`;
  const res=await fetch(url);
  const data=await res.json();
  tracks=data.filter(f=>f.name.endsWith(".mp3")||f.name.endsWith(".mp4")).map(f=>({
    name:f.name.replace(/\.(mp3|mp4)$/,''),
    url:f.download_url
  }));
  renderPlaylist();
  loadTrack(savedTrack!=null?savedTrack:0, true);
}

function renderPlaylist(){
  playlistEl.innerHTML="";
  tracks.forEach((track,i)=>{
    const item=document.createElement("div");
    item.className="playlist-item";
    item.textContent=track.name;
    item.onclick=()=>loadTrack(i);
    playlistEl.appendChild(item);
  });
}

function formatTime(sec){
  const m=Math.floor(sec/60);
  const s=Math.floor(sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

async function fetchCover(trackName){
  try{
    const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(trackName)}&entity=song&limit=1`);
    const data = await response.json();
    if(data.results && data.results[0] && data.results[0].artworkUrl100){
      return data.results[0].artworkUrl100.replace('100x100bb', '300x300bb');
    }
  }catch(e){console.log("Cover not found", e);}
  return "https://via.placeholder.com/300?text=No+Cover";
}

async function loadTrack(i, autoplay=false){
  current=i;
  const track=tracks[i];
  audio.src=track.url;
  titleEl.textContent=track.name;
  coverEl.src=await fetchCover(track.name);
  audio.currentTime=(i===savedTrack)?savedTime:0;
  audio.playbackRate=savedRate;
  speedSelect.value=savedRate;

  // شغل الصوت دائمًا عند تغيير الأغنية
  audio.play().catch(()=>{});

  playBtn.textContent=audio.paused?"▶":"❚❚";
  updateActive();
  saveProgress();
}

function updateActive(){
  document.querySelectorAll(".playlist-item").forEach((el,i)=>{
    el.classList.toggle("active",i===current);
  });
}

playBtn.onclick=()=>{
  if(audio.paused){audio.play(); playBtn.textContent="❚❚";}
  else{audio.pause(); playBtn.textContent="▶";}
};
nextBtn.onclick=()=>nextTrack();
prevBtn.onclick=()=>prevTrack();
backBtn.onclick=()=>{audio.currentTime=Math.max(0,audio.currentTime-10);};
forwardBtn.onclick=()=>{audio.currentTime=Math.min(audio.duration,audio.currentTime+10);};

speedSelect.onchange=()=>{
  const rate=parseFloat(speedSelect.value);
  audio.playbackRate=rate;
  savedRate=rate;
  localStorage.setItem('playbackRate',rate);
};

audio.ontimeupdate=()=>{
  if(audio.duration){
    progress.value=(audio.currentTime/audio.duration)*100;
    currentTimeEl.textContent=formatTime(audio.currentTime);
    durationEl.textContent=formatTime(audio.duration);
    saveProgress();
  }
};
progress.oninput=()=>{audio.currentTime=(progress.value/100)*audio.duration;};

function saveProgress(){
  localStorage.setItem('lastTrack',current);
  localStorage.setItem('lastTime',audio.currentTime);
}

function nextTrack(){ loadTrack((current+1)%tracks.length); }
function prevTrack(){ loadTrack((current-1+tracks.length)%tracks.length); }
audio.onended=()=>nextTrack();

fetchTracks();
</script>
</body>
</html>
